---
title: "Study *Tidy Finance with R*"
author: "Shitao"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
    number_sections: true
    code_folding: "show"
    css: "style.css"
    code_download: true
    includes:
      before_body: header.html
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.align = "center",
                      fig.asp = 0.618,
                      comment = "#>",
                      collapse = TRUE,
                      cache = TRUE)
```

# Introduction {.unnumbered}

这是[Tidy Finance with R](https://www.tidy-finance.org)的学习记录，使用的R软件版本为`r paste0(version$major, ".", version$minor)`（`r paste(version$year, version$month, version$day, sep = "-")`），下载源码可点击页面最顶端标题右侧“Code > Download Rmd”。

对内容有疑问或建议的小伙伴，欢迎在[这里](https://github.com/Shitao5/tidy-finance)提交Issues或者Pull requests，在下先行谢过了。🤝🤝

# Introduction to Tidy Finance

说到Tidy（整洁），首先加载两个tidy开头的包，而后开始我们的工作。

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(tidyquant)
```

## 股票数据

读取苹果公司股票价格数据，`tq_get()`函数默认使用雅虎数据库，因此在国内需要连接外网后使用。

```{r}
price <- tq_get("AAPL", # Apple Stock
                get = "stock.price",
                from = "2000-01-01",
                to = "2022-06-30")
price
```

简单的可视化，呈现价格走势：

```{r}
price %>% 
  ggplot(aes(date, adjusted)) +
  geom_line() +
  labs(x = NULL, y = NULL,
       title = "AAPL stock prices",
       subtitle = "Prices in USD, adjusted for dividend payments and stock splits")
```

## Daily Return （日收益率）

\begin{equation}
\text{daily return} = \frac{p_t - p_{t-1}}{p_{t-1}} = \frac{p_t}{p_{t-1}} - 1
\end{equation}

根据以上公式，用调整后价格计算日收益率：

```{r}
returns <- price %>% 
  arrange(date) %>% 
  mutate(ret = adjusted / lag(adjusted) - 1) %>% 
  select(symbol, date, ret)
returns
```

计算前需先将数据根据日期排序，由于`r dplyr::arrange(price, date)$date[1]`为第一天，因此计算收益率时产生缺失值(NA)，在这里可以直接剔除：

```{r}
returns <- returns %>% 
  drop_na(ret)
```








