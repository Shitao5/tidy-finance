---
title: "Study *Tidy Finance with R*"
author: "Shitao"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
    number_sections: true
    code_folding: "show"
    css: "style.css"
    code_download: true
    includes:
      before_body: header.html
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.align = "center",
                      fig.asp = 0.618,
                      comment = "#>",
                      collapse = TRUE,
                      cache = TRUE)
```

# Introduction {.unnumbered}

è¿™æ˜¯[Tidy Finance with R](https://www.tidy-finance.org)çš„å­¦ä¹ è®°å½•ï¼Œä½¿ç”¨çš„Rè½¯ä»¶ç‰ˆæœ¬ä¸º`r paste0(version$major, ".", version$minor)`ï¼ˆ`r paste(version$year, version$month, version$day, sep = "-")`ï¼‰ï¼Œä¸‹è½½æºç å¯ç‚¹å‡»é¡µé¢æœ€é¡¶ç«¯æ ‡é¢˜å³ä¾§â€œCode > Download Rmdâ€ã€‚

å¯¹å†…å®¹æœ‰ç–‘é—®æˆ–å»ºè®®çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿åœ¨[è¿™é‡Œ](https://github.com/Shitao5/tidy-finance)æäº¤Issuesæˆ–è€…Pull requestsï¼Œåœ¨ä¸‹å…ˆè¡Œè°¢è¿‡äº†ã€‚ğŸ¤ğŸ¤

# Introduction to Tidy Finance

è¯´åˆ°Tidyï¼ˆæ•´æ´ï¼‰ï¼Œé¦–å…ˆåŠ è½½ä¸¤ä¸ªtidyå¼€å¤´çš„åŒ…ï¼Œè€Œåå¼€å§‹æˆ‘ä»¬çš„å·¥ä½œã€‚

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(tidyquant)
```

## è‚¡ç¥¨æ•°æ®

è¯»å–è‹¹æœå…¬å¸è‚¡ç¥¨ä»·æ ¼æ•°æ®ï¼Œ`tq_get()`å‡½æ•°é»˜è®¤ä½¿ç”¨é›…è™æ•°æ®åº“ï¼Œå› æ­¤åœ¨å›½å†…éœ€è¦è¿æ¥å¤–ç½‘åä½¿ç”¨ã€‚

```{r}
price <- tq_get("AAPL", # Apple Stock
                get = "stock.price",
                from = "2000-01-01",
                to = "2022-06-30")
price
```

ç®€å•çš„å¯è§†åŒ–ï¼Œå‘ˆç°ä»·æ ¼èµ°åŠ¿ï¼š

```{r}
price %>% 
  ggplot(aes(date, adjusted)) +
  geom_line() +
  labs(x = NULL, y = NULL,
       title = "AAPL stock prices",
       subtitle = "Prices in USD, adjusted for dividend payments and stock splits")
```

## Daily Return ï¼ˆæ—¥æ”¶ç›Šç‡ï¼‰

\begin{equation}
\text{daily return} = \frac{p_t - p_{t-1}}{p_{t-1}} = \frac{p_t}{p_{t-1}} - 1
\end{equation}

æ ¹æ®ä»¥ä¸Šå…¬å¼ï¼Œç”¨è°ƒæ•´åä»·æ ¼è®¡ç®—æ—¥æ”¶ç›Šç‡ï¼š

```{r}
returns <- price %>% 
  arrange(date) %>% 
  mutate(ret = adjusted / lag(adjusted) - 1) %>% 
  select(symbol, date, ret)
returns
```

è®¡ç®—å‰éœ€å…ˆå°†æ•°æ®æ ¹æ®æ—¥æœŸæ’åºï¼Œç”±äº`r dplyr::arrange(price, date)$date[1]`ä¸ºç¬¬ä¸€å¤©ï¼Œå› æ­¤è®¡ç®—æ”¶ç›Šç‡æ—¶äº§ç”Ÿç¼ºå¤±å€¼(NA)ï¼Œåœ¨è¿™é‡Œå¯ä»¥ç›´æ¥å‰”é™¤ï¼š

```{r}
returns <- returns %>% 
  drop_na(ret)
```








